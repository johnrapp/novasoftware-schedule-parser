<!DOCTYPE html>
<html>
<head>
	<title></title>
	<style type="text/css">
		body {
		}
		#wrapper {
			opacity: 0.5;
			position: absolute;
			top: 8px;
		}
		#container {
			background: #bbb;
			position: relative;
		}
		.lesson {
			position: absolute;
			background: white;
			border: 1px solid black;
			box-sizing: border-box;
		}
	</style>
	<script type="text/javascript" src="jquery.js"></script>
</head>

<body>

<img src="test-schedule.png">
<div id="wrapper">
	<div id="container"></div>
</div>
<script type="text/javascript">
window.module = {};
</script>

<script type="text/javascript" src="paper-parse-lessons.js"></script>

<script type="text/javascript">
var parseLessons = window.module.exports;
</script>


<script type="text/javascript">

// vgy w: 610.93, h: 315
// norra w: 862.665 h: 223
$.getJSON('test-schedule.json', function(pdfData) {
// $.getJSON('schedules-vgy/14esmu.json', function(pdfData) {
// $.getJSON('schedules-norra/NB13.json', function(pdfData) {
// $.getJSON('schedules-ostra/N13b.json', function(pdfData) {
// $.getJSON('schedules-katte-u/N13B.json', function(pdfData) {
	var lessons = parseLessons(pdfData, render, postRender);
	console.log(lessons);
});

function render(width, height, days, titles) {
	// console.log(width, height)
	var $container = $('#container')

	$container.width(width).height(height);

	var dayColors = ['#f00', '#0f0', '#00f', '#ff0', '#f0f']
	days.forEach(function(day) {
		day.lessonFills.forEach(function(fill, i) {
			var element = $('<div>')
				.addClass('lesson')
				.width(fill.w)
				.height(fill.h)
				.css({
					// background: dayColors[fill.day],
					background: fill.oc,
					left: fill.x,
					top: fill.y
				})
				.appendTo($container)
				.click(function() {

					alert(
						'startTime: ' + fill.startTime + '\n' +
						'endTime: ' + fill.endTime + '\n' + (fill.details && fill.details[0] ?
						'course: ' + fill.details[0].course + '\n' +
						'teacher: ' + fill.details[0].teacher + '\n' +
						'location: ' + fill.details[0].location + '\n' +
						'unknown: ' + fill.details[0].unknown + '\n' : '')
					);

					console.log({
						details: fill.details,
						rows: fill.rows.map(x => x.text),
						startTime: fill.startTime,
						endTime: fill.endTime
					});
				});

			fill.element = element;
		});

		day.lessonTexts.forEach(function(text, i) {
			var element = $('<div>')
				.addClass('lesson')
				.width(text.w)
				.height(text.h)
				.css({
					// background: dayColors[text.day],
					background: 'black',
					left: text.x,
					top: text.y,
					border: 0
				})
				// .attr({
				// 	text: text.text
				// })
				.appendTo($container);

			text.element = element;
		});

		day.timeTexts.forEach(function(text, i) {
			var element = $('<div>')
				.addClass('lesson')
				.width(text.w)
				.height(text.h)
				.css({
					// background: dayColors[text.day],
					background: 'white',
					left: text.x,
					top: text.y,
					border: 0
				})
				.appendTo($container);

			text.element = element;
		});
	});

	titles.forEach(function(text, i) {
		var element =$('<div>')
			.addClass('lesson')
			.width(text.w)
			.height(text.h)
			.css({
				// background: dayColors[text.day],
				background: 'darkblue',
				left: text.x,
				top: text.y,
				border: 0
			})
			.appendTo($container);

		text.element = element;
	});
}

function postRender(days) {
	days.forEach(function(day) {
		day.lessonFills
		.filter(function(fill) {
			return fill.details == null;
		})
		.forEach(function(fill, i) {
			console.log(Math.round(fill.cx), Math.round(fill.cy), fill.element)
			fill.element
			.css({
				// background: 'darkred',
			});
		});
	});
}

</script>

</body>
</html>